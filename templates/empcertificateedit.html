<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Certificate Measure Report</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link href="https://fonts.cdnfonts.com/css/cooper-black" rel="stylesheet">

    <style>
/* @import url('https://fonts.cdnfonts.com/css/cooper-black'); 
h1 {
            font-family: 'Copper Black', serif;
            font-size: 48px; 
            text-align: center; 
        } */
                h1 {
            -webkit-text-fill-color: #da3936;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f9f9f9;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .form-container {
            background: #fff;
            padding: 30px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            width: 90%;
            max-width: 900px;
        }

        .form-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .form-header h1 {
            margin: 0;
            font-size: 1.8em;
            color: #333;
        }

        .form-header p {
            margin: 5px 0;
            font-size: 0.9em;
            color: #777;
        }

        .table-responsive {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            margin-top: 20px;
        }

        .custom-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 700px;
        }

        .custom-table th,
        .custom-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        .custom-table th {
            background-color: #f4f4f4;
            color: #333;
        }

        .btn {
            background-color: #7d2ae8;
            color: #fff;
            padding: 5px 10px;
            border-radius: 5px;
            text-decoration: none;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .btn:hover {
            background-color: #5c1bb7;
        }

        .form-header img {
            height: 60px;
        }

        @media (max-width: 768px) {
            .form-container {
                padding: 15px;
                width: 95%;
            }
            
            .form-header h1 {
                font-size: 1.4em;
            }
            
            .form-header p {
                font-size: 0.8em;
            }
        }

        .footer {
            text-align: center;
            padding: 10px;
            color: white;
            background-color: rgb(49, 45, 45);
            border-top: 1px solid #e7e7e7;
            margin-top: 20px;
        }
        /* Navigation Bar */
        .nav-bar {
            background-color: #282525;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-bar h1 {
            color: white;
            margin: 0;
            font-size: 24px;
        }

        .nav-links ul {
            list-style-type: none;
            margin: 0;
            padding: 0;
            display: flex;
            gap: 2rem;
        }

        .nav-links a {
            text-decoration: none;
            color: white;
            font-size: 16px;
            transition: color 0.3s ease;
        }

        .nav-links a:hover {
            color: #007bff;
        }

        .search-container {
    margin: 20px 0;
    position: relative;
}



/* Hamburger Menu Styles */
.hamburger {
        display: none;
        background: none;
        border: none;
        color: white;
        font-size: 24px;
        cursor: pointer;
        padding: 10px;
    }

    .sidebar {
        position: fixed;
        right: -50%;
        top: 0;
        height: 100%;
        width: 50%;
        background-color: #282525;
        transition: left 0.3s ease;
        z-index: 1000;
        padding-top: 20px;
    }

    .sidebar.active {
        right: 0;
    }

    .sidebar ul {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .sidebar li {
        padding: 15px 20px;
        border-bottom: 1px solid #444;
    }

    .sidebar a {
        color: white;
        text-decoration: none;
        font-size: 18px;
    }

    .sidebar-backdrop {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.5);
        z-index: 999;
        display: none;
    }

    .sidebar-backdrop.active {
        display: block;
    }

    @media (max-width: 1200px) {
        .nav-links {
            display: none;
        }
        
        .hamburger {
            display: block;
        }
    }


    /*Search and pagination controls*/
    .search-container {
            margin: 20px 0;
            position: relative;
        }

        #globalSearch {
            width: 90%;
            padding: 10px 15px;
            border: 2px solid #ddd;
            border-radius: 25px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        #globalSearch:focus {
            outline: none;
            border-color: #7d2ae8;
            box-shadow: 0 0 8px rgba(125, 42, 232, 0.3);
        }

        .pagination-controls {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            gap: 15px;
            margin-top: 20px;
        }

        .entries-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        #entriesPerPage {
            padding: 5px 10px;
            border-radius: 5px;
            border: 1px solid #ddd;
        }

        .page-info {
            font-size: 14px;
            color: #666;
        }

        .pagination-buttons {
            display: flex;
            gap: 10px;
        }

        .page-btn {
            padding: 5px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: #f4f4f4;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .page-btn:hover:not(:disabled) {
            background: #7d2ae8;
            color: white;
            border-color: #7d2ae8;
        }

        .page-btn:disabled {
            background: #ddd;
            cursor: not-allowed;
            opacity: 0.7;
        }
        .status-indicator {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 8px 15px;
    border-radius: 50px;  /* ✅ Rounded */
    font-weight: bold;
    text-align: center;
    min-width: 150px;
}

/* ✅ Status Colors */
.status-open { background-color: rgb(0, 203, 0); color: white; }
.status-in-progress { background-color: yellow; color: black; }
.status-completed { background-color: red; color: white; }
.status-unknown { background-color: gray; color: white; }

/* ✅ Small Status Circle */
.status-circle {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    display: inline-block;
    background-color: currentColor;
}

/*Sort function style */
.status-filters {
    margin: 10px 0;
    display: flex;
    gap: 15px;
}

.status-filters label {
    display: flex;
    align-items: center;
    gap: 5px;
    cursor: pointer;
}

.status-filters input[type="checkbox"] {
    margin: 0;
    cursor: pointer;
}


.status-draft {
    background-color: #6c757d; /* Gray color for draft status */
    color: white;
}

    /*Date filter*/
    .filter-controls {
        display: flex;
        gap: 15px;
        margin: 15px 0;
        align-items: center;
    }

    .date-filter {
        display: flex;
        gap: 10px;
        align-items: center;
    }

    .date-filter input[type="date"] {
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 5px;
        font-family: 'Poppins', sans-serif;
    }

    @media (max-width: 768px) {
        .filter-controls {
            flex-direction: column;
            align-items: stretch;
        }
        
        .date-filter {
            flex-direction: column;
            align-items: stretch;
        }
}

    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
</head>
<body>
    <div class="form-container">

        <div class="form-header">
            <div>
                <!-- Navigation Bar -->
        <div class="nav-bar">
            <a href="{{ url_for('empformsonm') }}" 
            style="display: inline-block; padding: 10px 20px; background-color: #007bff; color: white; text-decoration: none; border-radius: 5px; font-weight: bold; text-align: center; transition: 0.3s;"
            onmouseover="this.style.backgroundColor='#0056b3'"
            onmouseout="this.style.backgroundColor='#007bff'">
            Back
         </a>
         <!-- Hamburger Button -->
        <button class="hamburger">
            <i class="fa fa-bars"></i>
        </button>
            <nav class="nav-links">
                <ul>
                    <li><a href="{{ url_for('empdash') }}">Home</a></li>
                    <li><a href="{{ url_for('empforms') }}">Forms</a></li>
                    <li><a href="{{ url_for('logout') }}">Logout</a></li>
                </ul>
            </nav>
        </div>

         <!-- Sidebar -->
       <div class="sidebar" id="sidebar">
        <ul>
            <li><a href="{{ url_for('empdash') }}">Home</a></li>
            <li><a href="{{ url_for('empforms') }}">Forms</a></li>
            <li><a href="{{ url_for('logout') }}">Logout</a></li>
        </ul>
    </div>


    <!-- Backdrop -->
    <div class="sidebar-backdrop"></div>
    <h1 style="font-family: 'Cooper Black', sans-serif; font-weight: normal; font-size: 34px; color: #da3936 ;">VIKING MARINE INC.</h1>           

                <p>#143, Dinnur Village, Kadugodi Colony, Opp. India Satcom, Whitefield, Bangalore-560 067</p>
                <p>Ph: +91-80-6561240 | Email: info@vikingmarine.com</p>
            </div>
            <h1>CERTIFICATE OF MEASUREMENT FORM</h1>
        </div>


        <div class="table-responsive">
        <div class="search-container">
            <input type="text" id="globalSearch" placeholder="Search ....">
        </div>
      

        <!--Date Filter-->
<div class="filter-controls">
    <div class="date-filter">
        <label>Filter by Date:</label>
        <input type="date" id="startDate">
        <span>to</span>
        <input type="date" id="endDate">
    </div>
</div>

        <!-- Add no results message here -->
        <div id="noResults" style="display: none; text-align: center; padding: 20px; color: #666; font-style: italic;">
            No records found matching the criteria
        </div>

        <!--Sort Checkboxes-->
        <div class="status-filters">
            <label><input type="checkbox" class="status-checkbox" value="Draft" unchecked> Draft</label>
            <label><input type="checkbox" class="status-checkbox" value="Open" unchecked> Open</label>
            <label><input type="checkbox" class="status-checkbox" value="In Progress" unchecked> In Progress</label>
            <label><input type="checkbox" class="status-checkbox" value="Completed" unchecked> Completed</label>
        </div>

            <table class="custom-table">
                <thead>
                    <tr>
                        <th>Edit Details</th>
                        <th>Status</th>
                        <th>Certificate Number</th>
                        <th>Date</th>
                        <th>Applicant Name</th>
                        <th>Shipper</th>
                        <th>Consignee</th>
                        <th>Total Packages</th>
                        <th>Print Details</th>
                        
                    </tr>
                </thead>
                <tbody>
                    {% for cer in cer_data %}
                    <tr>
                        <td><a href="{{ url_for('empcertificateedit1', CertificateNumber=cer.CertificateNumber) }}" class="btn">Edit</a></td>
                        <td>
                            <span class="status-indicator 
                            {% if cer.status == 'Draft' %} status-draft
                            {% elif cer.status == 'Open' %} status-open
                            {% elif cer.status == 'In Progress' %} status-in-progress
                            {% elif cer.status == 'Completed' %} status-completed
                            {% else %} status-unknown
                            {% endif %}">
                            <span class="status-circle"></span>{{ cer.status }}</span>
                        </td>
                        <td>{{ cer.CertificateNumber }}</td>
                        <td>{{ cer.date }}</td>
                        <td>{{ cer.applicant_name }}</td>
                        <td>{{ cer.shipper }}</td>
                        <td>{{ cer.consignee }}</td>
                        <td>{{ cer.total_pkgs }}</td>
                        <td><button class="btn print-btn" onclick="generatePDF(this)">Print</button></td>
                    </tr>
                    {% endfor %}
                    
                </tbody>
            </table>
        </div>

        <div class="pagination-controls">
            <div class="entries-control">
                <span>Show:</span>
                <select id="entriesPerPage">
                    <option value="5">5</option>
                    <option value="10">10</option>
                    <option value="15">15</option>
                    <option value="20">20</option>
                </select>
                <span>entries</span>
            </div>
            
            <div class="page-info" id="pageInfo"></div>
            
            <div class="pagination-buttons">
                <button class="page-btn" id="prevPage">Previous</button>
                <button class="page-btn" id="nextPage">Next</button>
            </div>
        </div>

        <footer class="footer">
            &copy; 2025 <strong>AYlabs</strong>. Crafted with care, protected with pride.
        </footer>
    </div>

    <script>
// Hamburger Menu Toggle
document.querySelector('.hamburger').addEventListener('click', function() {
            document.getElementById('sidebar').classList.toggle('active');
            document.querySelector('.sidebar-backdrop').classList.toggle('active');
        });

        // Close sidebar when clicking backdrop
        document.querySelector('.sidebar-backdrop').addEventListener('click', function() {
            document.getElementById('sidebar').classList.remove('active');
            this.classList.remove('active');
        });

        // Close sidebar when clicking a link
        document.querySelectorAll('.sidebar a').forEach(link => {
            link.addEventListener('click', () => {
                document.getElementById('sidebar').classList.remove('active');
                document.querySelector('.sidebar-backdrop').classList.remove('active');
            });
        });



        // Pagination and Search functionality
        let currentPage = 1;
        let entriesPerPage = parseInt(document.getElementById('entriesPerPage').value);
        let allRows = Array.from(document.querySelectorAll('.custom-table tbody tr'));
        let filteredRows = [...allRows];

        function updateTable() {
            const start = (currentPage - 1) * entriesPerPage;
            const end = start + entriesPerPage;
            
            filteredRows.forEach((row, index) => {
                row.style.display = (index >= start && index < end) ? '' : 'none';
            });

            // Update page info
            const totalPages = Math.ceil(filteredRows.length / entriesPerPage);
            document.getElementById('pageInfo').textContent = 
                `Page ${currentPage} of ${totalPages}`;

            // Disable/enable buttons
            document.getElementById('prevPage').disabled = currentPage === 1;
            document.getElementById('nextPage').disabled = currentPage === totalPages;
        }

 // Search functionality
 document.getElementById('globalSearch').addEventListener('input', function(e) {
            applyFilters(); // This will handle the search through the applyFilters function
            });


function updateTable() {
    const start = (currentPage - 1) * entriesPerPage;
    const end = start + entriesPerPage;

    // Hide all rows first
    allRows.forEach(row => row.style.display = 'none');
    
    // Show filtered/sorted rows
    filteredRows.forEach((row, index) => {
        row.style.display = (index >= start && index < end) ? '' : 'none';
    });
}
        // Entries per page change
        document.getElementById('entriesPerPage').addEventListener('change', function(e) {
            entriesPerPage = parseInt(e.target.value);
            currentPage = 1;
            updateTable();
        });

        // Pagination buttons
        document.getElementById('prevPage').addEventListener('click', () => {
            if(currentPage > 1) {
                currentPage--;
                updateTable();
            }
        });

        document.getElementById('nextPage').addEventListener('click', () => {
            const totalPages = Math.ceil(filteredRows.length / entriesPerPage);
            if(currentPage < totalPages) {
                currentPage++;
                updateTable();
            }
        });

        // Initial setup
        updateTable();



       // Updated PDF Generation with proper data mapping
       function generatePDF(button) {
    const row = button.closest('tr');
    const cells = row.cells;
    
    const doc = new jspdf.jsPDF('p', 'mm', 'a4');
    
    // Add company header
    doc.setFontSize(18);
    doc.setFont('helvetica', 'bold');
    doc.text("VIKING MARINE INC.", 105, 20, { align: 'center' });
    doc.setFontSize(12);
    doc.setFont('helvetica', 'normal');
    doc.text("#143, Dinnur Village, Kadugodi Colony, Opp. India Satcom, Whitefield, Bangalore-560 067", 105, 27, { align: 'center' });
    doc.text("Ph: +91-80-6561240 | Email: info@vikingmarine.com", 105, 32, { align: 'center' });

    // Certificate title
    doc.setFontSize(16);
    doc.setFont('helvetica', 'bold');
    doc.text("CERTIFICATE OF MEASUREMENT", 105, 45, { align: 'center' });
    
    // Main content container
    const startY = 55;
    let yPos = startY;
    
    // Create certificate table
    const columns = [
        { header: 'Field', dataKey: 'field' },
        { header: 'Details', dataKey: 'details' }
    ];
    
    const rows = [
        { field: 'Certificate Number', details: cells[1].textContent },
        { field: 'Date', details: cells[2].textContent },
        { field: 'Applicant Name', details: cells[3].textContent },
        { field: 'Shipper', details: cells[4].textContent },
        { field: 'Consignee', details: cells[5].textContent },
        { field: 'Total Packages', details: cells[6].textContent }
    ];

    // Table styling
    doc.autoTable({
        head: [columns.map(c => c.header)],
        body: rows.map(r => [r.field, r.details]),
        startY: yPos,
        theme: 'grid',
        styles: {
            fontSize: 12,
            cellPadding: 3,
            valign: 'middle'
        },
        headStyles: {
            fillColor: [125, 42, 232],
            textColor: 255,
            fontStyle: 'bold'
        },
        columnStyles: {
            0: { cellWidth: 60, fontStyle: 'bold' },
            1: { cellWidth: 120 }
        }
    });

    // Footer
    yPos = doc.lastAutoTable.finalY + 15;
    doc.setFontSize(10);
    doc.text("Authorized Signature", 30, yPos);
    doc.text("Date: ___________________", 160, yPos);
    
    // Save PDF
    const filename = `Certificate_${cells[1].textContent}.pdf`;
    doc.save(filename);
}


    //Sorting status functionality
    // Initialize variables
 currentPage = 1;
entriesPerPage = parseInt(document.getElementById('entriesPerPage').value);
allRows = Array.from(document.querySelectorAll('.custom-table tbody tr'));
filteredRows = [];

// Initial sorting by certificate number
function initialSort() {
    allRows.sort((a, b) => {
        const certA = a.cells[2].textContent;
        const certB = b.cells[2].textContent;
        return certA.localeCompare(certB);
    });
    filteredRows = [...allRows];
}

// Status filter functionality
const statusCheckboxes = document.querySelectorAll('.status-checkbox');

function applyFilters() {
    const searchTerm = document.getElementById('globalSearch').value.toLowerCase().trim();
    const selectedStatuses = Array.from(document.querySelectorAll('.status-checkbox:checked'))
        .map(checkbox => checkbox.value.toLowerCase());
    
    // Get date filter values
    const startDate = document.getElementById('startDate').value;
    const endDate = document.getElementById('endDate').value;

    filteredRows = allRows.filter(row => {
        // Global search across all relevant columns
        const rowText = Array.from(row.cells)
            .slice(2, 9) // Include columns: Status(2), CertNum(3), Date(4), Applicant(5), Shipper(6), Consignee(7)
            .map(cell => cell.textContent.toLowerCase())
            .join(' ');
        const matchesSearch = rowText.includes(searchTerm);

        // Status filter
        const statusElement = row.querySelector('.status-indicator');
        const status = statusElement.textContent.replace(/[\n\r]+|[\s]{2,}/g, ' ').trim().toLowerCase();
        const matchesStatus = selectedStatuses.length === 0 ? true : 
                            selectedStatuses.some(s => status.includes(s));

        // Date filter
        let dateInRange = true;
        if (startDate || endDate) {
            const rowDateStr = row.cells[3].textContent; // Date is in 5th column (index 4)
            const rowDate = new Date(rowDateStr);
            
            const start = startDate ? new Date(startDate) : new Date(-8640000000000000);
            const end = endDate ? new Date(endDate) : new Date(8640000000000000);
            
            // Set time components for accurate comparison
            start.setHours(0, 0, 0, 0);
            end.setHours(23, 59, 59, 999);
            
            dateInRange = rowDate >= start && rowDate <= end;
        }

        return matchesSearch && matchesStatus && dateInRange;
    });

    document.getElementById('noResults').style.display = 
        filteredRows.length === 0 ? 'block' : 'none';
    
    currentPage = 1;
    updateTable();
}

// Add event listeners for date inputs
document.getElementById('startDate').addEventListener('change', applyFilters);
document.getElementById('endDate').addEventListener('change', applyFilters);


// Table update function
function updateTable() {
    const start = (currentPage - 1) * entriesPerPage;
    const end = start + entriesPerPage;

    allRows.forEach(row => row.style.display = 'none');
    filteredRows.forEach((row, index) => {
        row.style.display = (index >= start && index < end) ? '' : 'none';
    });

    const totalPages = Math.ceil(filteredRows.length / entriesPerPage);
    document.getElementById('pageInfo').textContent = 
        `Page ${currentPage} of ${totalPages}`;
    
    document.getElementById('prevPage').disabled = currentPage === 1;
    document.getElementById('nextPage').disabled = currentPage === totalPages;
}

// Event listeners
document.getElementById('globalSearch').addEventListener('input', applyFilters);
document.getElementById('entriesPerPage').addEventListener('change', function(e) {
    entriesPerPage = parseInt(e.target.value);
    currentPage = 1;
    updateTable();
});




statusCheckboxes.forEach(checkbox => {
    checkbox.addEventListener('change', applyFilters);
});

// Initial setup
initialSort();
applyFilters();  // Initial filter call shows all records
updateTable();

</script>
        
</body>
</html>
